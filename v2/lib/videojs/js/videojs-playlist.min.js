/*! @name videojs-playlist @version 5.0.0 @license Apache-2.0 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("video.js")):"function"==typeof define&&define.amd?define(["video.js"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).videojsPlaylist=t(e.videojs)}(this,(function(e){"use strict";function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=t(e);let n=e=>{const t=e.playlist.autoadvance_;t.timeout&&e.clearTimeout(t.timeout),t.trigger&&e.off("ended",t.trigger),t.timeout=null,t.trigger=null};const l=(e,t)=>{var r;(n(e),"number"==typeof(r=t)&&!isNaN(r)&&r>=0&&r<1/0)?(e.playlist.autoadvance_.delay=t,e.playlist.autoadvance_.trigger=function(){const r=()=>l(e,t);e.one("play",r),e.playlist.autoadvance_.timeout=e.setTimeout((()=>{n(e),e.off("play",r),e.playlist.next()}),1e3*t)},e.one("ended",e.playlist.autoadvance_.trigger)):e.playlist.autoadvance_.delay=null},i=(e,t)=>{const r=!e.paused()||e.ended();return e.trigger("beforeplaylistitem",t.originalValue||t),t.playlistItemId_&&(e.playlist.currentPlaylistItemId_=t.playlistItemId_),e.poster(t.poster||""),e.src(t.sources),(e=>{const t=e.remoteTextTracks();let r=t&&t.length||0;for(;r--;)e.removeRemoteTextTrack(t[r])})(e),e.ready((()=>{if((t.textTracks||[]).forEach(e.addRemoteTextTrack.bind(e)),e.trigger("playlistitem",t.originalValue||t),r){const t=e.play();void 0!==t&&"function"==typeof t.then&&t.then(null,(e=>{}))}l(e,e.playlist.autoadvance_.delay)})),e},a=e=>!!e&&"object"==typeof e,o=e=>{const t=[];let r;return e.forEach((e=>{a(e)?r=e:(r=Object(e),r.originalValue=e),t.push(r)})),t},s=e=>{let t=1;e.forEach((e=>{e.playlistItemId_=t++}))},u=(e,t)=>{for(let r=0;r<e.length;r++)if(e[r].playlistItemId_===t)return r;return-1},c=(e,t)=>{let r=e,n=t;return"object"==typeof e&&(r=e.src),"object"==typeof t&&(n=t.src),/^\/\//.test(r)&&(n=n.slice(n.indexOf("//"))),/^\/\//.test(n)&&(r=r.slice(r.indexOf("//"))),r===n},d=(e,t)=>{for(let r=0;r<e.length;r++){const n=e[r].sources;if(Array.isArray(n))for(let e=0;e<n.length;e++){const l=n[e];if(l&&c(l,t))return r}}return-1},f=e=>{let t=-1;const r=e.length-1;for(;++t<e.length;){const n=t+Math.floor(Math.random()*(r-t+1)),l=e[n];e[n]=e[t],e[t]=l}return e};const y=function(e,t){!function(e,t,c=0){let y=null,p=!1;const g=e.playlist=(t,r=0)=>{if(p)throw new Error("do not call playlist() during a playlist change");if(Array.isArray(t)){const n=Array.isArray(y)?y.slice():null,l=t.slice();y=l.slice(),y.filter((e=>a(e))).length!==y.length&&(y=o(y)),s(y),p=!0,e.trigger({type:"duringplaylistchange",nextIndex:r,nextPlaylist:l,previousIndex:g.currentIndex_,previousPlaylist:n||[]}),p=!1,-1!==r&&g.currentItem(r),n&&e.setTimeout((()=>{e.trigger("playlistchange")}),0)}return y.map((e=>e.originalValue||e)).slice()};e.on("loadstart",(()=>{-1===g.currentItem()&&n(e)})),g.currentIndex_=-1,g.player_=e,g.autoadvance_={},g.repeat_=!1,g.currentPlaylistItemId_=null,g.currentItem=e=>{if(p)return g.currentIndex_;if("number"==typeof e&&g.currentIndex_!==e&&e>=0&&e<y.length)return g.currentIndex_=e,i(g.player_,y[g.currentIndex_]),g.currentIndex_;const t=g.player_.currentSrc()||"";if(g.currentPlaylistItemId_){const e=u(y,g.currentPlaylistItemId_),r=y[e];if(r&&Array.isArray(r.sources)&&d([r],t)>-1)return g.currentIndex_=e,g.currentIndex_;g.currentPlaylistItemId_=null}return g.currentIndex_=g.indexOf(t),g.currentIndex_},g.contains=e=>-1!==g.indexOf(e),g.indexOf=e=>{if("string"==typeof e)return d(y,e);const t=Array.isArray(e)?e:e.sources;for(let e=0;e<t.length;e++){const r=t[e];if("string"==typeof r)return d(y,r);if(r.src)return d(y,r.src)}return-1},g.currentIndex=()=>g.currentItem(),g.lastIndex=()=>y.length-1,g.nextIndex=()=>{const e=g.currentItem();if(-1===e)return-1;const t=g.lastIndex();return g.repeat_&&e===t?0:Math.min(e+1,t)},g.previousIndex=()=>{const e=g.currentItem();return-1===e?-1:g.repeat_&&0===e?g.lastIndex():Math.max(e-1,0)},g.first=()=>{if(p)return;const e=g.currentItem(0);if(y.length)return y[e].originalValue||y[e];g.currentIndex_=-1},g.last=()=>{if(p)return;const e=g.currentItem(g.lastIndex());if(y.length)return y[e].originalValue||y[e];g.currentIndex_=-1},g.next=()=>{if(p)return;const e=g.nextIndex();if(e!==g.currentIndex_){const t=g.currentItem(e);return y[t].originalValue||y[t]}},g.previous=()=>{if(p)return;const e=g.previousIndex();if(e!==g.currentIndex_){const t=g.currentItem(e);return y[t].originalValue||y[t]}},g.autoadvance=e=>{l(g.player_,e)},g.repeat=e=>void 0===e?g.repeat_:"boolean"==typeof e?(g.repeat_=!!e,g.repeat_):void r.default.log.error("videojs-playlist: Invalid value for repeat",e),g.sort=t=>{y.length&&(y.sort(t),p||e.trigger("playlistsorted"))},g.reverse=()=>{y.length&&(y.reverse(),p||e.trigger("playlistsorted"))},g.shuffle=({rest:t}={})=>{let r=0,n=y;t&&(r=g.currentIndex_+1,n=y.slice(r)),n.length<=1||(f(n),t&&y.splice(...[r,n.length].concat(n)),p||e.trigger("playlistsorted"))},Array.isArray(t)?g(t.slice(),c):y=[]}(this,e,t)};return(r.default.registerPlugin||r.default.plugin)("playlist",y),y.VERSION="5.0.0",y}));
